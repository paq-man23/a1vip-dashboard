<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A1 VIP Ticket Dashboard</title>

  <!-- PWA hooks -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="A1VIP">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <style>
    :root { --bg:#0b1220; --text:#e5e7eb; --border:rgba(148,163,184,.22);
            --gold:#facc15; --blue:#3b82f6; --pink:#ec4899; --red:#ef4444;
            --black:#000; --btn-color:#1e293b; --btn-color-hover:#facc15; }

    html,body{margin:0;padding:0;height:100%}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column}

    header{
      position:sticky;top:0;z-index:1000;padding:10px 16px;
      padding-top:calc(env(safe-area-inset-top) + 8px);
      background:#111827;border-bottom:1px solid var(--border);
      display:flex;align-items:center;gap:12px;
    }
    header img{height:150px}
    .title{font-size:2.1rem;line-height:1.05;font-weight:900;letter-spacing:.2px}

    /* ===== Login overlay ===== */
    .login-screen{
      position:fixed;inset:0;background:#020617;
      display:none;align-items:center;justify-content:center;z-index:5000;
    }
    .login-card{
      width:min(360px,90vw);background:#0f172a;border:1px solid var(--border);
      border-radius:16px;padding:20px;box-shadow:0 18px 40px rgba(0,0,0,.8);
      display:grid;gap:12px;
    }
    .login-card h2{margin:0;font-size:1.4rem;color:#facc15;text-align:center}
    .login-card p{margin:0;font-size:0.8rem;color:#9ca3af;text-align:center}

    .login-card label{
      font-size:0.85rem;font-weight:700;display:grid;gap:4px;color:#e5e7eb;
    }
    .login-card input{
      padding:10px;border-radius:10px;border:1px solid var(--border);
      background:#020617;color:#e5e7eb;
    }
    .login-actions{display:flex;justify-content:center;margin-top:6px}
    .login-btn{
      border:none;border-radius:999px;padding:10px 20px;font-weight:800;
      cursor:pointer;background:#facc15;color:#000;
    }
    .login-btn:hover{filter:brightness(1.05)}
    .login-error{
      min-height:16px;font-size:0.8rem;color:#f97373;text-align:center;margin-top:4px;
    }

    /* Base UI */
    .search-row{margin:10px 0 4px;display:flex;flex-direction:column;gap:6px}
    .search-row input{
      padding:8px 10px;border-radius:999px;border:1px solid var(--border);
      background:#020617;color:#e5e7eb;font-size:0.85rem;
    }
    .search-results{
      max-height:180px;overflow:auto;font-size:0.8rem;border-radius:10px;
      background:#020617;border:1px solid #111827;padding:4px 6px
    }
    .search-result-item{
      padding:4px 6px;border-radius:6px;cursor:pointer;color:#e5e7eb
    }
    .search-result-item:hover{background:#1f2937}
    .btn-highlight{box-shadow:0 0 0 2px #22d3ee,0 0 12px #22d3ee}

    .link-status{
      font-size:11px;min-height:14px;color:#9ca3af;padding:2px 16px 4px;
      opacity:.85;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    #installBtn{
      position:fixed;top:calc(env(safe-area-inset-top) + 8px);left:8px;
      z-index:1200;display:none;background:#16a34a;color:#fff;border:none;
      padding:8px 10px;border-radius:10px;font-weight:800;cursor:pointer
    }

    .top-tabs{
      padding:12px 16px 6px;
      background:linear-gradient(180deg,#0b1220 0%,rgba(11,18,32,.7) 100%)
    }
    .tabs-scroller{display:flex;gap:10px;overflow-x:auto;scroll-snap-type:x mandatory}
    .tabs-scroller::-webkit-scrollbar{display:none}

    .tab{
      flex:0 0 auto;scroll-snap-align:start;border:none;
      padding:10px 16px;border-radius:12px;cursor:pointer;
      font-weight:800;color:#fff;user-select:none;
      box-shadow:0 0 0 1px rgba(148,163,184,.22) inset;transition:.2s
    }
    .tab-main{background:var(--gold);color:#000}.tab-main:hover{background:#ffe44d}
    .tab-luxury{background:var(--blue)}.tab-luxury:hover{background:#60a5fa}
    .tab-accounts{background:var(--pink)}.tab-accounts:hover{background:#f472b6}
    .tab-travel{background:var(--red)}.tab-travel:hover{background:#f87171}
    .tab-social{background:#000}.tab-social:hover{background:#1f2937}
    .tab-admin{background:#fff;color:#000}.tab-admin:hover{background:#e5e7eb}

    main{flex:1;overflow:auto;padding:16px 16px 28px}
    .section{margin-bottom:30px}
    h3{color:#facc15;font-size:1.3rem;margin:10px 4px 14px}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .btn{
      display:flex;align-items:center;justify-content:center;gap:10px;
      padding:16px;border-radius:16px;background:var(--btn-color);
      color:#fff;font-weight:800;border:1px solid var(--border);
      transition:.25s;text-align:center
    }
    .btn:hover{background:var(--btn-color-hover);color:#000;box-shadow:0 0 15px var(--btn-color-hover)}

    details{
      background:#0f172a;border:1px solid var(--border);
      border-radius:12px;margin:10px 0
    }
    summary{cursor:pointer;font-weight:800;padding:10px 14px;color:#e5e7eb}
    details .inner{padding:12px}
    .note{color:#9ca3af;font-size:.9rem}

    .upload-card{
      background:#0f172a;border:1px solid var(--border);border-radius:14px;
      padding:16px;display:grid;gap:14px
    }
    .upload-grid{display:grid;grid-template-columns:1fr;gap:14px}
    .upload-grid label{font-weight:700}
    .upload-grid textarea{
      width:100%;min-height:120px;border-radius:10px;border:1px solid var(--border);
      background:#111827;color:#e5e7eb;padding:10px
    }

    .upload-grid input[type=file]{
      border:1px dashed var(--border);padding:12px;border-radius:10px;
      background:#0b1220;color:#e5e7eb
    }

    .targets{display:flex;flex-wrap:wrap;gap:10px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);
      padding:8px 12px;border-radius:999px;background:#111827
    }

    .upload-actions{display:flex;flex-wrap:wrap;gap:12px}
    .cta{border:none;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
    .cta-primary{background:#22d3ee;color:#0b1220}
    .cta-secondary{background:#facc15;color:#0b1220}

    .manager-row{display:flex;flex-wrap:wrap;gap:12px;margin-top:8px}
    .btn-add{background:#16a34a}
    .btn-remove{background:#ef4444}

    .modal{
      position:fixed;inset:0;background:rgba(0,0,0,.6);
      display:none;align-items:center;justify-content:center;z-index:2000
    }
    .modal-card{
      width:min(560px,92vw);background:#0f172a;border:1px solid var(--border);
      border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.5)
    }
    .modal h4{margin:0 0 12px;color:#facc15}
    .form-grid{display:grid;gap:12px}
    .form-grid label{font-weight:700}
    .form-grid select,.form-grid input{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);
      background:#111827;color:#e5e7eb
    }
    .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}

    .quick-link-bar{
      display:flex;gap:8px;align-items:center;padding:4px 16px 8px;
    }
    .quick-link-bar input{
      flex:1;padding:8px 10px;border-radius:999px;border:1px solid var(--border);
      background:#020617;color:#e5e7eb;font-size:0.85rem;
    }
    .btn-quick-go{padding:8px 12px;font-size:0.8rem}
    .btn-quick-add{padding:8px 12px;font-size:0.8rem;background:#22c55e;border-color:#22c55e}
    .btn-quick-add:hover{background:#4ade80;color:#022c22;box-shadow:0 0 10px rgba(34,197,94,.8);}
    .btn[data-quick="1"]{background:#22c55e;border-color:#22c55e}
    .btn[data-quick="1"]:hover{background:#4ade80;color:#022c22;box-shadow:0 0 12px rgba(34,197,94,.9);}
  </style>
</head>

<body>

  <!-- Login Screen (Updated with clean placeholders) -->
  <div id="loginScreen" class="login-screen" style="display:none;">
    <div class="login-card">
      <h2>A1 VIP Login</h2>
      <p>Please enter your credentials to continue.</p>

      <label>
        Username
        <input id="loginUser" type="text" autocomplete="username" placeholder="Username">
      </label>

      <label>
        Password
        <input id="loginPass" type="password" autocomplete="current-password" placeholder="Password">
      </label>

      <div class="login-actions">
        <button class="login-btn" onclick="handleLogin()">Login</button>
      </div>

      <div id="loginError" class="login-error"></div>
    </div>
  </div>
  <header>
    <img src="A1VIP_LOGO_VERT_for _Black_backgrounds.png" alt="Logo">
    <div class="title">A1 VIP<br/>Ticket<br/>Dashboard</div>
  </header>

  <div id="linkStatus" class="link-status"></div>

  <div class="quick-link-bar">
    <input id="quickLinkInput" type="url" placeholder="Paste or type a link (https://...)" />
    <button class="btn btn-quick-go" onclick="openQuickLink()">Go</button>
    <button class="btn btn-quick-add" onclick="addQuickLinkButton()">Add to Main</button>
  </div>

  <nav class="top-tabs">
    <div class="tabs-scroller">
      <button class="tab tab-main" onclick="showSection('main')">Main Links</button>
      <button class="tab tab-luxury" onclick="showSection('luxury')">Luxury Suites</button>
      <button class="tab tab-accounts" onclick="showSection('accounts')">Ticket Accounts</button>
      <button class="tab tab-travel" onclick="showSection('travel')">Travel</button>
      <button class="tab tab-social" onclick="showSection('social')">Social</button>
      <button class="tab tab-admin" onclick="showSection('admin')">Admin</button>
    </div>
  </nav>

  <main>

    <!-- Main -->
    <div id="main" class="section">
      <h3>Main Links</h3>
      <div class="grid" data-section="main"></div>
    </div>

    <!-- Luxury -->
    <div id="luxury" class="section" style="display:none;">
      <h3>Luxury Suites</h3>
      <div class="grid" data-section="luxury"></div>
    </div>

    <!-- Accounts -->
    <div id="accounts" class="section" style="display:none;">
      <h3>Ticket Accounts</h3>
      <div class="grid" data-section="accounts"></div>
    </div>

    <!-- Travel -->
    <div id="travel" class="section" style="display:none;">
      <h3>Travel</h3>
      <div class="grid" data-section="travel"></div>

      <details>
        <summary>Private Jet</summary>
        <div class="inner">
          <div class="grid" data-section="privatejet"></div>
        </div>
      </details>

      <details>
        <summary>Luxury Homes</summary>
        <div class="inner">
          <div class="grid" data-section="luxhomes"></div>
        </div>
      </details>
    </div>

    <!-- Social -->
    <div id="social" class="section" style="display:none;">
      <h3>Social</h3>
      <div class="grid" data-section="social"></div>
    </div>

    <!-- Admin -->
    <div id="admin" class="section" style="display:none;">
      <h3>Admin</h3>

      <div class="search-row">
        <input id="linkSearch" type="text" placeholder="Search buttons..." oninput="searchLinks()" />
        <div id="searchResults" class="search-results"></div>
      </div>

      <div class="grid">
        <button class="btn" onclick="showSection('domains')">A1 Domains & Emails</button>
        <button class="btn" onclick="openPopup('https://a1vipevents.com/')">A1VIP</button>
        <button class="btn" onclick="openPopup('https://a1vipevents.com/wp-login.php?redirect_to=https%3A%2F%2Fa1vipevents.com%2Fwp-admin%2F&reauth=1')">BackEnd</button>
        <button class="btn" onclick="showSection('upload')">UPLOAD</button>
        <button class="btn" onclick="showSection('buttonManager')">Button Manager</button>
        <button class="btn" style="display:none;" data-system-btn="1" onclick="showSection('system')">SYSTEM</button>
      </div>
    </div>

    <!-- SYSTEM -->
    <div id="system" class="section" style="display:none;">
      <h3>SYSTEM Tools</h3>

      <div class="grid">
        <button class="btn btn-remove" onclick="resetDashboard()">Reset Dashboard (Factory)</button>
        <button class="btn" onclick="toggleTheme()">Toggle Button Theme</button>
        <button class="btn" onclick="exportLayout()">Backup / Export Layout</button>
      </div>

      <div style="margin-top:10px;font-size:0.8rem;">
        <label for="themeColor">
          Button Color:
          <input id="themeColor" type="color" onchange="setThemeColor(this.value)">
        </label>
      </div>

      <p style="font-size:0.8rem;color:#9ca3af;margin-top:8px;">
        SYSTEM is hidden unless you hold the Alt/Option key while viewing Admin.
      </p>
    </div>

    <!-- Domains -->
    <div id="domains" class="section" style="display:none;">
      <h3>A1 Domains & Emails</h3>
      <div class="grid" data-section="domains"></div>
    </div>

    <!-- Upload -->
    <section id="upload" class="section" style="display:none;">
      <h3>UPLOAD</h3>

      <div class="upload-card">

        <div class="upload-grid">

          <div>
            <label for="uploadDesc">Post Description</label>
            <textarea id="uploadDesc" placeholder="Write caption or description..."></textarea>
            <div class="note">This copies to your clipboard for quick posting.</div>
          </div>

          <div>
            <label for="uploadFile">Video File</label>
            <input id="uploadFile" type="file" accept="video/*" />
            <div class="note">Browser security prevents auto-uploading to multiple sites.</div>
          </div>

          <div>
            <label>Targets</label>
            <div class="targets">
              <label class="chip"><input type="checkbox" id="tYouTube" checked> YouTube</label>
              <label class="chip"><input type="checkbox" id="tFacebook" checked> Facebook</label>
              <label class="chip"><input type="checkbox" id="tInstagram" checked> Instagram</label>
              <label class="chip"><input type="checkbox" id="tTikTok" checked> TikTok</label>
            </div>
          </div>

        </div>

        <div class="upload-actions">
          <button class="cta cta-secondary" onclick="copyDescription()">Copy Description</button>
          <button class="cta cta-primary" onclick="openUploadPages()">Open Upload Pages</button>
          <div class="note">If only one tab opens, enable popups for this page.</div>
        </div>

      </div>
    </section>

    <!-- Button Manager -->
    <section id="buttonManager" class="section" style="display:none;">
      <h3>Button Manager</h3>

      <div class="manager-row">
        <button class="btn btn-add" onclick="openAddModal()">‚ûï Add Button</button>
        <button class="btn" style="background:#3b82f6" onclick="openMoveModal()">üîÄ Move Button</button>
        <button class="btn" onclick="openRenameModal()">‚úèÔ∏è Rename Button</button>
        <button class="btn btn-remove" onclick="openRemoveModal()">‚ûñ Remove Button</button>
      </div>
    </section>

  </main>
  <!-- Add Modal -->
  <div id="addModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="addTitle">
    <div class="modal-card">
      <h4 id="addTitle">Add a New Button</h4>

      <div class="form-grid">
        <label>Section
          <select id="addSection"></select>
        </label>

        <label>Button Label
          <input id="addLabel" type="text" placeholder="e.g. Team Store">
        </label>

        <label>Button URL
          <input id="addUrl" type="url" placeholder="https://example.com">
        </label>
      </div>

      <div class="modal-actions">
        <button class="cta ghost" onclick="closeModal('addModal')">Cancel</button>
        <button class="cta cta-primary" onclick="confirmAdd()">Add</button>
      </div>
    </div>
  </div>

  <!-- Rename Modal -->
  <div id="renameModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="renameTitle">
    <div class="modal-card">
      <h4 id="renameTitle">Rename Button</h4>

      <div class="form-grid">
        <label>Section
          <select id="renameSection" onchange="populateRenameList()"></select>
        </label>

        <label>Button to Rename
          <select id="renameButton"></select>
        </label>

        <label>New Label
          <input id="renameNewLabel" type="text" placeholder="New button label">
        </label>
      </div>

      <div class="modal-actions">
        <button class="cta ghost" onclick="closeModal('renameModal')">Cancel</button>
        <button class="cta cta-primary" onclick="confirmRename()">Rename</button>
      </div>
    </div>
  </div>

  <!-- Remove Modal -->
  <div id="removeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="removeTitle">
    <div class="modal-card">
      <h4 id="removeTitle">Remove Button</h4>

      <div class="form-grid">
        <label>Section
          <select id="removeSection" onchange="populateRemoveList()"></select>
        </label>

        <label>Pick Button to Remove
          <select id="removeButton"></select>
        </label>
      </div>

      <div class="modal-actions">
        <button class="cta ghost" onclick="closeModal('removeModal')">Cancel</button>
        <button class="cta cta-secondary" onclick="confirmRemove()">Remove</button>
      </div>
    </div>
  </div>

  <!-- Move Modal -->
  <div id="moveModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="moveTitle">
    <div class="modal-card">
      <h4 id="moveTitle">Move Button</h4>

      <div class="form-grid">

        <label>From Section
          <select id="moveFrom" onchange="populateMoveList()"></select>
        </label>

        <label>Pick Button to Move
          <select id="moveButton"></select>
        </label>

        <label>To Section
          <select id="moveTo"></select>
        </label>

      </div>

      <div class="modal-actions">
        <button class="cta ghost" onclick="closeModal('moveModal')">Cancel</button>
        <button class="cta cta-primary" onclick="confirmMove()">Move</button>
      </div>
    </div>
  </div>

  <!-- JAVASCRIPT -->
  <script>
    /* ===== CONFIG ===== */
    const CONFIG_URLS = [
      "https://raw.githubusercontent.com/paq-man23/a1vip-dashboard/main/buttons.json",
      "https://paq-man23.github.io/a1vip-dashboard/buttons.json"
    ];
    const SYNC_ENDPOINT = "https://a1vip-sync.jviphone.workers.dev";
    const SHARED_SECRET = "a1vip-2025-sync-9fK2sX";
    const STORAGE_KEY   = "a1vip-button-manager-v2";

    /* ===== SIMPLE LOGIN AUTH ===== */
    const AUTH_USER = "JAW";
    const AUTH_PASS = "Da$h25";
    const AUTH_KEY  = "a1vip-auth-v1";

    function isAuthenticated(){
      try { return localStorage.getItem(AUTH_KEY) === "ok"; }
      catch(e){ return false; }
    }
    function showLogin(){
      const el = document.getElementById("loginScreen");
      if (el) el.style.display = "flex";
    }
    function hideLogin(){
      const el = document.getElementById("loginScreen");
      if (el) el.style.display = "none";
    }

    function handleLogin(){
      const uEl = document.getElementById("loginUser");
      const pEl = document.getElementById("loginPass");
      const err = document.getElementById("loginError");

      const u = (uEl?.value || "").trim();
      const p = pEl?.value || "";

      if (u === AUTH_USER && p === AUTH_PASS){
        try { localStorage.setItem(AUTH_KEY, "ok"); } catch(e){}
        hideLogin();
        if (err) err.textContent = "";
      } else {
        if (err) err.textContent = "Invalid username or password.";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (!isAuthenticated()) showLogin();
      else hideLogin();

      ["loginUser","loginPass"].forEach(id => {
        const el = document.getElementById(id);
        if (el){
          el.addEventListener("keydown", e => {
            if (e.key === "Enter") handleLogin();
          });
        }
      });
    });

    /* ====== SEED BUTTONS ====== */
    const SEED = {
      main: [
        ["Audience Rewards","https://www.audiencerewards.com/"],
        ["AXS","https://www.axs.com/"],
        ["Braintree","https://www.braintreegateway.com/login"],
        ["Broadway Box Discounts","https://www.broadwaybox.com/"],
        ["Broadwaydirect","https://tickets.broadwaydirect.com/shop/account/login?returnUrl=https://tickets.broadwaydirect.com/Account/Orders"],
        ["Charity buzz","https://www.charitybuzz.com/"],
        ["Chase Gets You In Lounge","https://chasegetsyoucloser.com/login/?msg=200"],
        ["ChatGPT","https://chatgpt.com/"],
        ["Clover Go A1","https://www.clover.com/login?webRedirectUrl=%2Fdashboard"],
        ["Core Ticketevolution","https://core.ticketevolution.com"],
        ["FedEx","https://www.fedex.com/secure-login/en-us/#/credentials"],
        ["Gametime Portal","https://portal.gametime.co/login"],
        ["Mailchimp","https://login.mailchimp.com/login/unified-login"],
        ["M&T Rewards","https://rewards.mtb.com/welcome.htm"],
        ["MLB.com","https://www.mlb.com/login?redirectUri=/apps/ballpark"],
        ["MyTicketmaster","https://www.ticketmaster.com"],
        ["Pollstar","https://www.pollstar.com/login"],
        ["Presale","https://www.presalepasswordinfo.com/members/checkuser.php"],
        ["Quint","https://quint.co/"],
        ["Rate Your Seats","https://www.rateyourseats.com"],
        ["Ryder Cup","https://onlocationexp.com/golf/ryder-cup-tickets"],
        ["SeatGeek","https://seatgeek.com/"],
        ["Seatgeek Portal","https://sellers.seatgeek.com/orders?status=all&selectedTab=all"],
        ["Skybox","https://skybox.vividseats.com/inventory?groupBy=event&sortedBy=event_date&sortDir=asc&limit=100&pageNumber=1&sortedByB=quantity&sortDirB=asc"],
        ["StubHub","https://www.stubhub.com/"],
        ["TAO Suite","https://www.suitesixteenlounge.com/"],
        ["TicketFlipping","https://ticketflipping.com/ticketflipping-toolbox/"],
        ["Ticket Utils","https://app.ticketutils.com/POS/DashBoard"],
        ["Ticketnetwork POS NEXT","https://posnext.ticketnetwork.com/#inventory"],
        ["Trade Desk","https://tradedesk.ticketmaster.com"],
        ["Victory Live","https://www.victorylive.com"],
        ["Vista Print","https://www.vistaprint.com/my-account/design/projects?xnav=accountMenu"]
      ],
      luxury: [
        ["Suite Experience","https://www.suiteexperiencegroup.com/"],
        ["Suite Hop","https://suitehop.com/"],
        ["MSG Premium Hospitality","https://www.msg.com/madison-square-garden/luxury-suites"],
        ["LSA Suites","https://lsaus.com/"],
        ["The Sphere Suites","https://www.thesphere.com/premium-suites"],
        ["Access Sports","https://accessvipsports.com/about-us/"]
      ],
      accounts: [
        ["Dolphins","https://am.ticketmaster.com/dolphins/my-events"],
        ["NY Islanders","https://am.ticketmaster.com/newyorkislanders/my-events#/17998"],
        ["Predators","https://am.ticketmaster.com/predators/my-events"],
        ["Vanderbilt","https://vucommodores.evenue.net/signin"],
        ["Vols","https://am.ticketmaster.com/allvols/my-events"],
        ["Yankees","https://am.ticketmaster.com/nyyreg/my-events"]
      ],
      travel: [
        ["ARCCORP","https://www2.arccorp.com/#"],
        ["Delta","https://www.delta.com/"],
        ["Expedia","https://www.expedia.com/Hotels?v=b"],
        ["EZ-PASS","https://www.e-zpassny.com/vector/account/transactions/transactionlist.do"],
        ["Jetset","https://jetsetjansen.com/versace-mansion-miami/"],
        ["JSX","https://www.jsx.com/home/search"],
        ["Universal","https://www.universalpartnercommunity.com/s/login/SelfRegister?language=en_US"],
        ["Yachts","https://www.burgessyachts.com/en/charter-a-yacht/yachts-for-charter/aquila-00005340"]
      ],
      privatejet: [
        ["Fly XO","https://flyxo.com/"],
        ["Flyte","https://www.flyte.travel/rebrand"],
        ["Private Jet Contracts","javascript:alert('Add contract link URL and I\\'ll wire this up.')"],
        ["Private Jet Fly USA","https://flyusa.com/book-private-flights/"],
        ["Wheels Up","https://wheelsup.com/"]
      ],
      luxhomes: [
        ["Airbnb","https://www.airbnb.com/"],
        ["VRBO","https://www.vrbo.com/"]
      ],
      social: [
        ["Facebook","https://www.facebook.com/"],
        ["Instagram","https://www.instagram.com/"],
        ["LinkedIn","https://www.linkedin.com/"],
        ["Mailchimp","https://mailchimp.com/"],
        ["Tiktok","https://tiktok.com/"],
        ["YouTube","https://www.youtube.com/"]
      ],
      domains: [
        ["A1 Timesheets","https://1drv.ms/x/c/f3acac4cab808f86/EQsA5-xNQvBApOR3XhRkD1EBNC3MT3eW0wlrza-6wpYNPQ?e=fbawZI"],
        ["Domain Pal","https://domainpal.com/"],
        ["GoDaddy","https://www.godaddy.com/"]
      ]
    };

    function seedDOM(){
      Object.entries(SEED).forEach(([sec, items])=>{
        const grid = sectionGrid(sec);
        if (!grid) return;
        items.forEach(([label,url])=>{
          grid.appendChild(createBtn(label, url, false));
        });
      });
    }

    /* ========= SEARCH ========= */
    function searchLinks(){
      const input = document.getElementById("linkSearch");
      const results = document.getElementById("searchResults");
      const q = (input?.value || "").trim().toLowerCase();
      results.innerHTML = "";

      if (!q) return;

      const matches = [];
      document.querySelectorAll(".grid[data-section] .btn").forEach(btn=>{
        const label = btn.textContent.trim();
        if (label.toLowerCase().includes(q)){
          const grid = btn.closest(".grid");
          const secId = grid.getAttribute("data-section");
          matches.push({ label, secId, btn });
        }
      });

      matches.slice(0,50).forEach(m=>{
        const div = document.createElement("div");
        div.className = "search-result-item";
        const secMeta = (window.manageableSections || []).find(x => x.id === m.secId);
        div.textContent = `${secMeta ? secMeta.label : m.secId}: ${m.label}`;
        div.onclick = () => {
          const sec = (m.secId === "privatejet" || m.secId === "luxhomes") ? "travel" : m.secId;
          showSection(sec);
          if (sec === "travel"){
            document.querySelectorAll("#travel details").forEach(d => d.open = true);
          }

          setTimeout(()=>{
            m.btn.scrollIntoView({ behavior:"smooth", block:"center" });
            m.btn.classList.add("btn-highlight");
            setTimeout(()=>m.btn.classList.remove("btn-highlight"),1200);
          },80);
        };
        results.appendChild(div);
      });
    }


    /* ====== LOCAL STORAGE ====== */
    function loadState(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || { added:{}, removed:{} }; }
      catch{ return { added:{}, removed:{} }; }
    }
    function saveState(s){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    function sectionGrid(id){
      return document.querySelector(`.grid[data-section="${id}"]`);
    }

    function createBtn(label, url, isCustom=true){
      const b = document.createElement("button");
      b.className = "btn";
      b.textContent = label;
      if (url) b.dataset.url = url;
      if (isCustom) b.dataset.custom = "1";
      b.onclick = () => openPopup(url);
      return b;
    }

    function openPopup(url){
      if (url && url.startsWith("javascript:")){
        new Function(url.slice(11))();
      } else {
        window.open(url, "_blank", "popup=yes,scrollbars=yes,resizable=yes,width=1200,height=800");
      }
    }

    function normLabel(s){
      return (s || "").normalize("NFKC").replace(/\s+/g," ").trim().toLowerCase();
    }

    /* ===== MERGING REMOTE ===== */
    async function fetchRemoteConfig(){
      for (const base of CONFIG_URLS){
        try{
          const res = await fetch(`${base}?v=${Date.now()}`, { cache:"no-store" });
          if (res.ok){
            const json = await res.json();
            return json && typeof json === "object" ? json : { added:{}, removed:{} };
          }
        } catch(e){}
      }
      return { added:{}, removed:{} };
    }

    function mergeStates(base, remote){
      const merged = JSON.parse(JSON.stringify(base || { added:{}, removed:{} }));

      // Merge ADDED
      for (const [sec, arr] of Object.entries(remote.added || {})){
        merged.added[sec] = merged.added[sec] || [];
        const seen = new Map(merged.added[sec].map(x => [normLabel(x.label), x]));

        (arr || []).forEach(item=>{
          const nl = normLabel(item.label);
          if (!seen.has(nl)) seen.set(nl, { label:item.label, url:item.url });
          else if (item.url && item.url !== seen.get(nl).url){
            seen.set(nl, { label:item.label, url:item.url });
          }
        });

        merged.added[sec] = Array.from(seen.values());
      }

      // Merge REMOVED
      for (const [sec, labels] of Object.entries(remote.removed || {})){
        const prev = new Set((merged.removed?.[sec] || []).map(normLabel));
        const next = new Set((labels || []).map(normLabel));
        merged.removed[sec] = Array.from(new Set([...prev, ...next]));
      }

      // Reconcile: removed beats added
      const secs = new Set([...Object.keys(merged.added||{}), ...Object.keys(merged.removed||{})]);
      for (const sec of secs){
        const rem = new Set((merged.removed?.[sec] || []).map(normLabel));
        if (merged.added[sec]){
          merged.added[sec] = merged.added[sec].filter(x => !rem.has(normLabel(x.label)));
        }
      }

      return merged;
    }

    /* ===== APPLY STATE ===== */
    function applyState(state){
      // Reset grids
      document.querySelectorAll(".grid[data-section]").forEach(g => g.innerHTML = "");

      seedDOM();

      const removedMap = {};
      Object.entries(state.removed || {}).forEach(([sec, labels])=>{
        const list = new Set((labels || []).map(normLabel));
        removedMap[sec] = list;

        const grid = sectionGrid(sec);
        if (!grid) return;
        [...grid.querySelectorAll(".btn")].forEach(b=>{
          if (list.has(normLabel(b.textContent))) b.remove();
        });
      });

      Object.entries(state.added || {}).forEach(([sec, arr])=>{
        const grid = sectionGrid(sec);
        if (!grid) return;

        const removed = removedMap[sec] || new Set();
        const existing = new Set([...grid.querySelectorAll(".btn")].map(b=>normLabel(b.textContent)));

        arr.sort((a,b)=>a.label.localeCompare(b.label)).forEach(item=>{
          const nl = normLabel(item.label);
          if (removed.has(nl)) return;
          if (existing.has(nl)) return;

          grid.appendChild(createBtn(item.label, item.url, true));
          existing.add(nl);
        });
      });

      wireHoverStatus();
    }

    function wireHoverStatus(){
      const bar = document.getElementById("linkStatus");
      const buttons = document.querySelectorAll(".grid .btn");

      buttons.forEach(btn=>{
        if (btn.dataset.hoverWired === "1") return;
        btn.dataset.hoverWired = "1";

        const url = btn.dataset.url || "";
        btn.addEventListener("mouseenter", ()=> bar.textContent = url);
        btn.addEventListener("mouseleave", ()=> bar.textContent = "");
        btn.addEventListener("focus", ()=> bar.textContent = url);
        btn.addEventListener("blur", ()=> bar.textContent = "");
      });
    }

    /* ===== BUTTON MANAGER ===== */
    function fillSelect(id){
      const sel = document.getElementById(id);
      if (!sel) return;

      sel.innerHTML = "";
      (window.manageableSections || []).forEach(s=>{
        const o = document.createElement("option");
        o.value = s.id;
        o.textContent = s.label;
        sel.appendChild(o);
      });
    }

    function showModal(id){
      const m = document.getElementById(id);
      if (m) m.style.display = "flex";
    }
    function closeModal(id){
      const m = document.getElementById(id);
      if (m) m.style.display = "none";
    }

    function openAddModal(){
      fillSelect("addSection");
      document.getElementById("addLabel").value = "";
      document.getElementById("addUrl").value = "";
      showModal("addModal");
    }

    async function confirmAdd(){
      const sec   = document.getElementById("addSection").value;
      const label = document.getElementById("addLabel").value.trim();
      const url   = document.getElementById("addUrl").value.trim();

      if (!sec || !label || !url){
        alert("Fill out all fields."); return;
      }

      const grid = sectionGrid(sec);
      if (!grid){ alert("Section missing."); return; }

      const newBtn = createBtn(label, url, true);
      grid.appendChild(newBtn);

      const state = loadState();
      state.added[sec] = state.added[sec] || [];

      const nl = normLabel(label);
      const idx = state.added[sec].findIndex(x => normLabel(x.label) === nl);
      if (idx >= 0) state.added[sec][idx].url = url;
      else state.added[sec].push({ label, url });

      saveState(state);

      const remote = await fetchRemoteConfig();
      const merged = mergeStates(state, remote);

      merged.removed[sec] = (merged.removed[sec] || []).filter(x => normLabel(x) !== nl);

      await syncRemote(merged);

      closeModal("addModal");
      alert("Button added.");
    }

    function openRenameModal(){
      fillSelect("renameSection");
      populateRenameList();
      showModal("renameModal");
    }

    function populateRenameList(){
      const sec = document.getElementById("renameSection").value;
      const list = document.getElementById("renameButton");
      list.innerHTML = "";

      const grid = sectionGrid(sec);
      if (!grid) return;

      [...grid.querySelectorAll(".btn")].forEach(btn=>{
        const o = document.createElement("option");
        o.value = btn.textContent.trim();
        o.textContent = btn.textContent.trim();
        list.appendChild(o);
      });
    }

    async function confirmRename(){
      const sec       = document.getElementById("renameSection").value;
      const oldLabel  = document.getElementById("renameButton").value;
      const newLabel  = document.getElementById("renameNewLabel").value.trim();

      if (!sec || !oldLabel || !newLabel){
        alert("Fill out all fields."); return;
      }
      if (normLabel(oldLabel) === normLabel(newLabel)){
        alert("Names match."); return;
      }

      const grid = sectionGrid(sec);
      const btn = [...grid.querySelectorAll(".btn")]
        .find(b => normLabel(b.textContent) === normLabel(oldLabel));

      if (!btn){ alert("Button not found."); return; }

      const url = btn.dataset.url;
      btn.textContent = newLabel;

      const state = loadState();
      state.added[sec] = state.added[sec] || [];
      state.removed[sec] = state.removed[sec] || [];

      const nlOld = normLabel(oldLabel);
      const nlNew = normLabel(newLabel);

      let found = false;
      for (let item of state.added[sec]){
        if (normLabel(item.label) === nlOld){
          item.label = newLabel;
          item.url = url;
          found = true;
          break;
        }
      }

      if (!found){
        state.removed[sec].push(oldLabel);
        state.added[sec].push({ label:newLabel, url:url });
      }

      state.removed[sec] = state.removed[sec].filter(x => normLabel(x) !== nlNew);

      saveState(state);

      const remote = await fetchRemoteConfig();
      const merged = mergeStates(state, remote);
      await syncRemote(merged);

      closeModal("renameModal");
      alert("Renamed.");
    }

    function openMoveModal(){
      fillSelect("moveFrom");
      fillSelect("moveTo");
      populateMoveList();
      showModal("moveModal");
    }

    function populateMoveList(){
      const sec = document.getElementById("moveFrom").value;
      const list = document.getElementById("moveButton");
      list.innerHTML = "";

      const grid = sectionGrid(sec);
      if (!grid) return;

      [...grid.querySelectorAll(".btn")].forEach(btn=>{
        const raw = btn.textContent.trim();
        const o = document.createElement("option");
        o.value = normLabel(raw);
        o.textContent = raw;
        o.dataset.raw = raw;
        list.appendChild(o);
      });
    }

    async function confirmMove(){
      const from = document.getElementById("moveFrom").value;
      const to   = document.getElementById("moveTo").value;
      const sel  = document.getElementById("moveButton");

      if (!from || !to || !sel.value){ alert("Fill out fields."); return; }
      if (from === to){ alert("Same section."); return; }

      const rawLabel = sel.options[sel.selectedIndex].dataset.raw;
      const nl = normLabel(rawLabel);

      const fromGrid = sectionGrid(from);
      const toGrid   = sectionGrid(to);

      let url = "";
      const btn = [...fromGrid.querySelectorAll(".btn")]
        .find(b => normLabel(b.textContent) === nl);

      if (btn){
        url = btn.dataset.url || "";
        btn.remove();
      }

      const newBtn = createBtn(rawLabel, url, true);
      toGrid.appendChild(newBtn);

      const state = loadState();
      state.added[from] = state.added[from] || [];
      state.removed[from] = state.removed[from] || [];
      state.added[to] = state.added[to] || [];
      state.removed[to] = state.removed[to] || [];

      const idx = state.added[from].findIndex(x => normLabel(x.label) === nl);
      if (idx >= 0){
        state.added[from].splice(idx,1);
      } else {
        state.removed[from].push(rawLabel);
      }

      state.removed[to] = state.removed[to].filter(x => normLabel(x) !== nl);
      state.added[to].push({ label:rawLabel, url });

      saveState(state);

      const remote = await fetchRemoteConfig();
      const merged = mergeStates(state, remote);
      await syncRemote(merged);

      closeModal("moveModal");
      alert("Button moved.");
    }

    async function confirmRemove(){
      const sec = document.getElementById("removeSection").value;
      const sel = document.getElementById("removeButton");

      if (!sec || !sel.value){
        alert("Pick a button."); return;
      }

      const raw = sel.options[sel.selectedIndex].dataset.raw;
      const nl  = normLabel(raw);

      const grid = sectionGrid(sec);
      [...grid.querySelectorAll(".btn")].forEach(btn=>{
        if (normLabel(btn.textContent) === nl) btn.remove();
      });

      const state = loadState();
      state.added[sec] = (state.added[sec] || []).filter(
        x => normLabel(x.label) !== nl
      );

      state.removed[sec] = state.removed[sec] || [];
      if (!state.removed[sec].some(x => normLabel(x) === nl)){
        state.removed[sec].push(raw);
      }

      saveState(state);

      const remote = await fetchRemoteConfig();
      const merged = mergeStates(state, remote);
      await syncRemote(merged);

      closeModal("removeModal");
      alert("Button removed.");
    }

    /* ====== INIT ====== */
    async function init(){
      seedDOM();

      const local = loadState();
      const remote = await fetchRemoteConfig();
      const merged = mergeStates(local, remote);

      saveState(merged);
      applyState(merged);

      const savedColor = localStorage.getItem("a1vip-theme-color");
      if (savedColor){
        setThemeColor(savedColor);
        const picker = document.getElementById("themeColor");
        if (picker) picker.value = savedColor;
      }

      setInterval(async ()=>{
        const remote = await fetchRemoteConfig();
        const newMerged = mergeStates(loadState(), remote);
        saveState(newMerged);
        applyState(newMerged);
      }, 30000);
    }

    function setThemeColor(hex){
      document.documentElement.style.setProperty("--btn-color", hex);
      const hover = lightenHex(hex, 0.12);
      document.documentElement.style.setProperty("--btn-color-hover", hover);
      localStorage.setItem("a1vip-theme-color", hex);
    }

    function lightenHex(hex, amt){
      try{
        let c = hex.replace("#","");
        if (c.length === 3){
          c = c.split("").map(ch=>ch+ch).join("");
        }
        let num = parseInt(c,16);
        let r = (num>>16)&255;
        let g = (num>>8)&255;
        let b = num&255;
        r = Math.min(255, r + (255-r)*amt);
        g = Math.min(255, g + (255-g)*amt);
        b = Math.min(255, b + (255-b)*amt);
        return "#" + ((r<<16)|(g<<8)|b).toString(16).padStart(6,"0");
      }catch(e){ return hex; }
    }

    async function syncRemote(state){
      if (!SYNC_ENDPOINT) return;

      try{
        const res = await fetch(SYNC_ENDPOINT, {
          method:"POST",
          headers:{
            "Content-Type":"application/json",
            "X-A1VIP-Secret": SHARED_SECRET
          },
          body: JSON.stringify(state)
        });

        if (!res.ok){
          const txt = await res.text();
          alert("Sync failed: " + txt);
          return;
        }

        const remote = await fetchRemoteConfig();
        const merged = mergeStates(loadState(), remote);
        saveState(merged);
        applyState(merged);

      } catch(e){
        alert("Sync error: " + e.message);
      }
    }

    window.addEventListener("DOMContentLoaded", init);
  </script>


  <!-- SERVICE WORKER -->
  <script>
    if ("serviceWorker" in navigator){
      window.addEventListener("load", async () => {
        try{
          const reg = await navigator.serviceWorker.register("./sw.v4.js");

          function showUpdatePrompt(waitingSW){
            const bar = document.createElement("div");
            bar.style.cssText = `
              position:fixed;left:0;right:0;bottom:0;padding:12px 16px;
              background:#111827;color:#fff;display:flex;gap:12px;
              justify-content:center;align-items:center;z-index:9999;
              border-top:1px solid rgba(148,163,184,.22);
            `;
            bar.innerHTML = `
              <span>New update available.</span>
              <button id="a1vip-update"
                style="background:#22d3ee;border:none;color:#0b1220;font-weight:800;
                border-radius:10px;padding:8px 12px;cursor:pointer;">Update</button>
              <button id="a1vip-dismiss"
                style="background:transparent;border:1px solid rgba(148,163,184,.22);
                color:#e5e7eb;border-radius:10px;padding:8px 12px;cursor:pointer;">Later</button>
            `;
            document.body.appendChild(bar);

            document.getElementById("a1vip-dismiss").onclick = () => bar.remove();
            document.getElementById("a1vip-update").onclick = () => {
              waitingSW.postMessage({ type:"SKIP_WAITING" });
            };

            navigator.serviceWorker.addEventListener("controllerchange", ()=>{
              setTimeout(()=>location.reload(), 100);
            });
          }

          if (reg.waiting) showUpdatePrompt(reg.waiting);

          reg.addEventListener("updatefound", ()=>{
            const newSW = reg.installing;
            newSW.addEventListener("statechange", ()=>{
              if (newSW.state === "installed" && reg.waiting){
                showUpdatePrompt(reg.waiting);
              }
            });
          });

          setInterval(()=>reg.update().catch(()=>{}), 30*60*1000);

        } catch(e){
          console.error("SW registration failed", e);
        }
      });
    }
  </script>

</body>
</html>
